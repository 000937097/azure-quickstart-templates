{
    "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
    "handler": "Microsoft.Azure.CreateUIDef",
    "version": "0.1.2-preview",
    "parameters": {
        "basics": [
            {
                "name": "virtualMachineScaleSetName",
                "type": "Microsoft.Common.TextBox",
                "label": "Virtual Machine Scale Set name",
                "toolTip": "The name of the Virtual Machine Scale Set.",
                "defaultValue": "cvmss",
                "constraints": {
                    "required": true,
                    "regex": "^[a-z0-9A-Z-]{1,15}$",
                    "validationMessage": "The VMSS Name must be between 1 and 15 characters long and contain letters, numbers and hyphens only."
                }
            },
			{
				"name": "osType",
				"type": "Microsoft.Common.DropDown",
				"label": "Operating System",
				"defaultValue": "Windows",
				"constraints": {
					"allowedValues": [
						{
							"label": "Windows",
							"value": "Windows"
						},
						{
							"label": "Linux",
							"value": "Linux"
						}
					]
				}
			},
            {
                "name": "adminUsername",
                "type": "Microsoft.Compute.UserNameTextBox",
                "label": "Username",
                "toolTip": "Admin username for the machine",
                "defaultValue": "azureuser",
                "constraints": {
                    "required": true
                }
            },
			{
				"name": "adminPassword",
				"type": "Microsoft.Common.PasswordBox",
				"label": "Admin Password",
				"constraints": {
					"required": true,
					"minLength": 8,
					"maxLength": 123,
					"regex": "^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[^a-zA-Z\\d]).{8,}$",
					"validationMessage": "Password must be 8-123 characters long and include a mix of uppercase, lowercase, numeric, and special characters."
				},
				"visible": "[equals(parameters('osType'), 'Windows')]"
			},
            {
                "name": "SSHCredentials",
                "type": "Microsoft.Compute.CredentialsCombo",
                "label": {
                    "authenticationType": "Authentication type",
                    "password": "Password",
                    "confirmPassword": "Confirm password",
                    "sshPublicKey": "SSH public key"
                },
                "toolTip": {
                    "authenticationType": "Authentication Type for the Virtual Machine Scale set",
                    "password": "Password for the Virtual Machine Scale set",
                    "sshPublicKey": "SSH Public Key for the Virtual Machine Scale set"
                },
                "constraints": {
                    "required": true
                },
                "options": {
                    "hideConfirmation": false
                },
                "visible": "[equals(parameters('osType'), 'Linux')]"
            },
            {
                "name": "vmSize",
                "type": "Microsoft.Compute.SizeSelector",
                "label": "Virtual machine Scaleset size",
                "toolTip": "The size of confidential virtual machine scale set to provision.",
                "recommendedSizes": [
                    "Standard_DC2as_v5",
                    "Standard_DC4as_v5",
					"Standard_DC2ads_v5",
					"Standard_DC4ads_v5"
                ],
                "count": "1"
            },
			{
				"name": "windowsCvmImage",
				"type": "Microsoft.Common.DropDown",
				"label": "Windows Image",
				"defaultValue": "2022-datacenter-smalldisk-g2",
				"constraints": {
					"allowedValues": [
						{
							"label": "Windows Server 2022 Datacenter SmallDisk",
							"value": "2022-datacenter-smalldisk-g2"
						},
						{
							"label": "Windows Server 2022 Datacenter",
							"value": "2022-datacenter-g2"
						},
						{
							"label": "Windows Server 2022 Datacenter Core SmallDisk",
							"value": "2022-datacenter-core-smalldisk-g2"
						},
						{
							"label": "Windows Server 2022 Datacenter Core",
							"value": "2022-datacenter-core-g2"
						},
						{
							"label": "Windows Server 2022 Azure edition",
							"value": "2022-datacenter-azure-edition-smalldisk"
						},
						{
							"label": "Windows Server 2022 Azure edition hotpatch SmallDisk",
							"value": "2022-datacenter-azure-edition-hotpatch-smalldisk"
						},
						{
							"label": "Windows Server 2022 Azure edition SmallDisk",
							"value": "2022-datacenter-azure-edition-hotpatch"
						},
						{
							"label": "Windows Server 2022 Azure edition Core SmallDisk",
							"value": "2022-datacenter-azure-edition-core-smalldisk"
						},
						{
							"label": "Windows Server 2022 Azure edition Core",
							"value": "2022-datacenter-azure-edition-core"
						},
						{
							"label": "Windows Server 2022 Azure edition",
							"value": "2022-datacenter-azure-edition"
						}
					]
				},
				"visible": "[equals(parameters('osType'), 'Windows')]"
			},
			{
				"name": "linuxCvmImage",
				"type": "Microsoft.Common.DropDown",
				"label": "Linux Image",
				"defaultValue": "22_04-lts-cvm",
				"constraints": {
					"allowedValues": [
						{
							"label": "Ubuntu Server 20.04 LTS (CVM)",
							"value": "20_04-lts-cvm"
						},
						{
							"label": "Ubuntu Server 22.04 LTS (CVM)",
							"value": "22_04-lts-cvm"
						},
						{
							"label": "Red Hat Enterprise Linux (CVM)",
							"value": "9_3_cvm_sev_snp"
						}
					]
				},
				"visible": "[equals(parameters('osType'), 'Linux')]"
			},
			{
				"name": "instanceCount",
				"type": "Microsoft.Common.Slider",
				"label": "Instance Count",
				"defaultValue": 5,
				"constraints": {
					"min": 1,
					"max": 100,
					"step": 1,
					"required": true
				}
			}			
        ],
        "outputs": {
			"virtualMachineScaleSetName": "[basics('virtualMachineScaleSetName')]",
			"osType": "[basics('osType')]",
			"adminUsername": "[settings('adminUsername')]",
			"adminPassword": "[settings('adminPassword')]",
			"SSHCredentials": "[settings('SSHCredentials')]",
			"vmSize": "[settings('vmSize')]",
			"windowsCvmImage": "[settings('windowsCvmImage')]",
			"linuxCvmImage": "[settings('linuxCvmImage')]",
			"instanceCount": "[settings('instanceCount')]"
        }
    }
}
