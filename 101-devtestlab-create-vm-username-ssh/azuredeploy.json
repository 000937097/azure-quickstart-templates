{
  "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "vmName": {
      "type": "string",
      "metadata": {
        "description": "The name of the new vm to be created."
      }
    },
    "labName": {
      "type": "string",
      "metadata": {
        "description": "The name of an existing lab where the new vm will be created. The lab's resource group should be the same as the one to which this template is being deployed."
      }
    },
    "vmTemplateName": {
      "type": "string",
      "metadata": {
        "description": "The name of an existing vm template which will be used to creat the new vm. The specified vm template must exist in the lab (identified via the 'labName' parameter)."
      }
    },
    "vmSize": {
      "type": "string",
      "metadata": {
        "description": "The size of the new vm to be created."
      }
    },
    "userName": {
      "type": "string",
      "metadata": {
        "description": "The username for the local account that will be created on the new vm."
      }
    },
    "sshKey": {
      "type": "securestring",
      "metadata": {
        "description": "The SSH key for the local account that will be created on the new vm."
      }
    }
  },
  "resources": [
    {
      "apiVersion": "2015-05-21-preview",
      "type": "Microsoft.DevTestLab/environments",
      "name": "[parameters('vmName')]",
      "location": "[resourceGroup().location]",
      "properties": {
        "labId": "[resourceId('Microsoft.DevTestLab/labs', parameters('labName'))]",
        "vms": [
          {
            "name": "[parameters('vmName')]",
            "vmTemplateName": "[parameters('vmTemplateName')]",
            "size": "[parameters('vmSize')]",
            "isAuthenticationWithSshKey": true,
            "userName": "[parameters('userName')]",
            "sshKey": "[parameters('useSshKey')]",
            "password": ""
          }
        ]
      }
    }
  ],
  "outputs": {
    "vmId": {
      "type": "string",
      "value": "[resourceId('Microsoft.DevTestLab/environments', parameters('vmName'))]"
    }
  }
}
