{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "adminUsername": {
      "type": "string",
      "defaultValue": "azureuser",
      "metadata": {
        "description": "User name for the Virtual Machine."
      }
    },
    "adminPassword": {
      "type": "securestring",
      "metadata": {
        "description": "Password for the Virtual Machine."
      }
    },
    "DNSNamePrefix": {
      "type": "string",
      "metadata": {
        "description": "Sets the Domain name label for the cluster.  The concatenation of the domain name label, a role indicator ('jb', 'man' or none) and the regionalized DNS zone make up the fully qualified domain name associated with the public IP address. For example, if you enter 'dns' here and deploy to Japan East your fully qualified domain names for this cluster will be dnsjb.japaneast.cloudapp.azure.com (for the jumpbox), dnsman.japaneast.cloudapp.azure.com (for the management endpoints) and dns.japaneast.cloudapp.azure.com (for the cluster hosts)."
      }
    },
    "agentCount": {
      "type": "int",
      "defaultValue": 1,
      "metadata": {
        "description": "The number of Mesos agents for the cluster.  This value can be from 1 to 100"
      },
      "allowedValues": [
        1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,
        21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40
      ]
    },
    "masterCount": {
      "type": "int",
      "defaultValue": 1,
      "allowedValues": [
        1,
        3,
        5
      ],
      "metadata": {
        "description": "The number of Mesos masters for the cluster."
      }
    },
    "sshRSAPublicKey": {
      "type": "string",
      "defaultValue": "disabled",
      "metadata": {
        "description": "Configure all linux machines with the SSH rsa public key string.  Use 'disabled' to not configure access with SSH rsa public key."
      }
    }
  },

  "variables": {
    "adminUsername": "[parameters('adminUsername')]",
    "adminPassword": "[parameters('adminPassword')]",
    "jumpboxOS": "Linux",
    "jumpboxEndpointDNSNamePrefix": "[concat(parameters('DNSNamePrefix'), 'jb')]",
    "managementEndpointDNSNamePrefix": "[concat(parameters('DNSNamePrefix'), 'man')]",
    "applicationEndpointDNSNamePrefix": "[parameters('DNSNamePrefix')]",
    "agentCount": "[parameters('agentCount')]",
    "masterCount": "[parameters('masterCount')]",
    "agentVMSize": "Standard_A2",
    "sshRSAPublicKey": "[parameters('sshRSAPublicKey')]",
  },

  "resources": [
    {
      "apiVersion": "2015-11-01-preview",
      "type": "Microsoft.ContainerService/containerServices",
      "location": "[resourceGroup().location]",
      "name":"anhowe1116a",
      "properties": {
        "orchestratorProfile": {
          "orchestratorType": "Mesos"
        },
        "masterProfile": {
          "count": "[variables('masterCount')]",
          "dnsPrefix": "[variables('managementEndpointDNSNamePrefix')]"
        },
        "agentPoolProfiles": [
          {
            "name": "agentpools",
            "count": "[variables('agentCount')]",
            "vmSize": "[variables('agentVMSize')]",
            "dnsPrefix": "[variables('applicationEndpointDNSNamePrefix')]"
          }
        ],
        "osProfile": {
          "adminUsername": "[variables('adminUsername')]",
          "adminPassword": "[variables('adminPassword')]",
          "linuxConfiguration": {
            "ssh": {
              "publicKeys": [
                {
                  "keyData": "[variables('sshRSAPublicKey')]"
                }
              ]
            }
          }
        },
        "jumpboxProfile": {
          "osType": "[variables('jumpboxOS')]",
          "dnsPrefix": "[variables('jumpboxEndpointDNSNamePrefix')]"
        }
      }
    }
  ]
}

