{
    "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "name": {
            "type": "string",
            "metadata": {
                "description": "Name of the Vault"
            }
        },
        "location": {
            "type": "string",
            "allowedValues": [
                "East US",
                "West US",
                "Central US",
                "West Europe",
                "South East Asia"
            ],
            "metadata": {
                "description": "This is the location where the backup vault will be created"
            }
        },
        "skuName": {
            "type": "string",
            "defaultValue": "Standard",
            "allowedValues": [
                "Standard",
                "Premium"
            ],
            "metadata": {
                "description": "SKU for the vault"
            }
        },
        "policyName": {
            "type": "string",
            "metadata": {
                "description": "Name of the Backup Policy"
            }
        },
        "workloadType": {
            "type": "string",
            "metadata": {
                "description": "Type of Workload"
            }
        },
        "backupType": {
            "type": "string",
            "metadata": {
                "description": "Type of Backup"
            }
        },
        "scheduleRun": {
            "type": "string",
            "metadata": {
                "description": "Backup Run Schedule"
            }
        },
        "scheduleRunDays": {
            "type": "array",
            "metadata": {
                "description": "Backup Schedule Run Days"
            }
        },
        "scheduleRunTimes": {
            "type": "array",
            "metadata": {
                "description": "Backup Schedule Run Times"
            }
        },
        "dailyRetentionTimes": {
            "type": "array",
            "metadata": {
                "description": "LTR Daily Backup Retention Times"
            }
        },
        "dailyRetentionDurationCount": {
            "type": "int",
            "metadata": {
                "description": "LTR Daily Backup Retention Duration Count"
            }
        },
        "dailyRetentionDurationType": {
            "type": "string",
            "metadata": {
                "description": "LTR Daily Backup Retention Duration Type"
            }
        },
        "weeklyRetentionDaysOfTheWeek": {
            "type": "array",
            "metadata": {
                "description": "LTR Weekly Backup Retention Days of Week"
            }
        },
        "weeklyRetentionTimes": {
            "type": "array",
            "metadata": {
                "description": "LTR Weekly Backup Retention Times"
            }
        },
        "weeklyRetentionDurationCount": {
            "type": "int",
            "metadata": {
                "description": "LTR Weekly Backup Retention Duration Count"
            }
        },
        "weeklyRetentionDurationType": {
            "type": "string",
            "metadata": {
                "description": "LTR Weekly Backup Retention Duration Type"
            }
        }
    },
    "resources": [
        {
            "apiVersion": "2015-03-15",
            "name": "[parameters('name')]",
            "location": "[parameters('location')]",
            "type": "Microsoft.Backup/BackupVault",
            "properties": {
                "sku": {
                    "name": "[parameters('skuName')]"
                }
            },
            "resources": [
                {
                    "apiVersion": "2015-03-15",
                    "type": "protectionPolicies",
                    "name": "[parameters('policyName')]",
                    "dependsOn": [
                        "[concat('Microsoft.Backup/BackupVault/', parameters('name'))]"
                    ],
                    "properties": {
                        "WorkloadType": "[parameters('workloadType')]",
                        "PolicyName": "[parameters('policyName')]",
                        "BackupSchedule": {
                            "backupType": "[parameters('backupType')]",
                            "scheduleRun": "[parameters('scheduleRun')]",
                            "scheduleRunDays": "[parameters('scheduleRunDays')]",
                            "scheduleRunTimes": "[parameters('scheduleRunTimes')]"
                        },
                        "LTRRetentionPolicy": {
                            "DailySchedule": {
                                "RetentionTimes": "[parameters('dailyRetentionTimes')]",
                                "CSMRetentionDuration": {
                                    "Count": "[parameters('dailyRetentionDurationCount')]",
                                    "DurationType": "[parameters('dailyRetentionDurationType')]"
                                }
                            },
                            "WeeklySchedule": {
                                "DaysOfTheWeek": "[parameters('weeklyRetentionDaysOfTheWeek')]",
                                "RetentionTimes": "[parameters('weeklyRetentionTimes')]",
                                "CSMRetentionDuration": {
                                    "Count": "[parameters('weeklyRetentionDurationCount')]",
                                    "DurationType": "[parameters('weeklyRetentionDurationType')]"
                                }
                            }
                        }
                    }
                }
            ]
        }
    ]
}