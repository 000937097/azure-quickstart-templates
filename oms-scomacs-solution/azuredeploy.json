{
   "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
   "contentVersion": "1.0.0.0",
   "parameters": {
        "workspaceName": {
            "type": "string",
            "metadata": {
                "description": "Workspace Name"
            }
        },
        "serviceTier": {
            "type": "string",
            "allowedValues": [
                "Free",
                "Standalone",
                "PerNode"
            ],
            "metadata": {
                "description": "Service Tier: Free, Standalone, or PerNode"
            }
        },
        "location": {
            "type": "string",
            "allowedValues": [
                "East US",
                "West Europe",
                "Southeast Asia",
                "Australia Southeast"
            ]
        }
     },
   "variables": {
        "Security": {
            "Name": "[Concat('Security', '(', parameters('workspaceName'), ')')]",
            "GalleryName": "Security"
        }
     },
   "resources": [  
        {
        "apiVersion": "2015-11-01-preview",
        "type": "Microsoft.OperationalInsights/workspaces",
        "name": "[parameters('workspaceName')]",
        "location": "[parameters('location')]",
        "properties": {
            "sku": {
            "Name": "[parameters('serviceTier')]"
            }
        },
        "resources": [
            {   
                "apiVersion": "2015-11-01-preview",
                "location": "[parameters('location')]",
                "name": "[variables('Security').Name]",
                "type": "Microsoft.OperationsManagement/solutions",
                "id": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.OperationsManagement/solutions/', variables('Security').Name)]",
                "dependsOn": [
                    "[concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
                ],
                "properties": {
                    "workspaceResourceId": "[resourceId('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
                },
                "plan": {
                    "name": "[variables('Security').Name]",
                    "publisher": "Microsoft",
                    "product": "[Concat('OMSGallery/', variables('Security').GalleryName)]",
                    "promotionCode": ""
                }
            },
            {
                "apiVersion": "2015-11-01-preview",
                "name": "AccountLocked1",
                "type": "savedSearches",
                "dependsOn": [
                    "[concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
                ],
                "properties": {
                    "Category": "ACS Report Queries",
                    "ETag": "*",
                    "DisplayName": "Access Violation: Account Locked (Details)",
                    "Query": "Type=SecurityEvent EventID=539 OR EventID=644 OR EventID=4740 OR EventID=6279",
                    "Version": 1
                }
            },
            {
                "apiVersion": "2015-11-01-preview",
                "name": "AccountLocked2",
                "type": "savedSearches",
                "dependsOn": [
                    "[concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
                ],
                "properties": {
                    "Category": "ACS Report Queries",
                    "ETag": "*",
                    "DisplayName": "Access Violation: Account Locked (Events Count)",
                    "Query": "Type=SecurityEvent EventID=539 OR EventID=644 OR EventID=4740 OR EventID=6279 | measure count() by EventID",
                    "Version": 1
                }
            },
            {
                "apiVersion": "2015-11-01-preview",
                "name": "LogonAttempts1",
                "type": "savedSearches",
                "dependsOn": [
                    "[concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
                ],
                "properties": {
                    "Category": "ACS Report Queries",
                    "ETag": "*",
                    "DisplayName": "Access Violation: Unsuccessful Logon Attempts (Details)",
                    "Query": "Type=SecurityEvent EventID:[529..537] OR EventID=539 OR (EventID=4625 AND Status=0xc000006d) | Select TargetAccount, IpAddress, Computer, LogonProcessName, AuthenticationPackageName, LogonTypeName",
                    "Version": 1
                }
            },
            {
                "apiVersion": "2015-11-01-preview",
                "name": "LogonAttempts2",
                "type": "savedSearches",
                "dependsOn": [
                    "[concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
                ],
                "properties": {
                    "Category": "ACS Report Queries",
                    "ETag": "*",
                    "DisplayName": "Access Violation: Unsuccessful Logon Attempts (Target Account Count)",
                    "Query": "Type=SecurityEvent EventID:[529..537] OR EventID=539 OR (EventID=4625 AND Status=0xc000006d) | measure count() by TargetAccount",
                    "Version": 1
                }
            },
            {
                "apiVersion": "2015-11-01-preview",
                "name": "AdminMembershipChange1",
                "type": "savedSearches",
                "dependsOn": [
                    "[concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
                ],
                "properties": {
                    "Category": "ACS Report Queries",
                    "ETag": "*",
                    "DisplayName": "Account Management: Domain and Built-in Administrators Membership Changes (Member Added)",
                    "Query": "Type=SecurityEvent EventID=4728 OR EventID=4732 OR EventID=4756 OR EventID=632 OR EventID=636 OR EventID=660 AND (\"*512\" OR \"S-1-5-32-544\") | Extend \"Add Member\" AS Action | Select Action, TargetUserName, Activity, SubjectAccount, MemberName, TimeGenerated, Computer",
                    "Version": 1
                }
            },
            {
                "apiVersion": "2015-11-01-preview",
                "name": "AdminMembershipChange2",
                "type": "savedSearches",
                "dependsOn": [
                    "[concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
                ],
                "properties": {
                    "Category": "ACS Report Queries",
                    "ETag": "*",
                    "DisplayName": "Account Management: Domain and Built-in Administrators Membership Changes (Member Removed)",
                    "Query": "Type=SecurityEvent EventID=4729 OR EventID=4733 OR EventID=4757 OR EventID=633 OR EventID=637 OR EventID=661 AND (\"*512\" OR \"S-1-5-32-544\") | Extend \"Remove Member\" AS Action | Select Action, TargetUserName, Activity, SubjectAccount, MemberName, TimeGenerated, Computer",
                    "Version": 1
                }
            },
            {
                "apiVersion": "2015-11-01-preview",
                "name": "PasswordChange",
                "type": "savedSearches",
                "dependsOn": [
                    "[concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
                ],
                "properties": {
                    "Category": "ACS Report Queries",
                    "ETag": "*",
                    "DisplayName": "Account Management: Passwords Change Attempts by Non-Owner",
                    "Query": "Type=SecurityEvent (EventID=4723 OR EventID=4724 OR EventID:[627..628]) AND SubjectAccount!=\"ANONYMOUS LOGON\" TargetAccount NOT IN {Type=SecurityEvent (EventID=4723 OR EventID=4724 OR EventID:[627..628]) AND SubjectAccount!=\"ANONYMOUS LOGON\" | measure count() by SubjectAccount} | EXTEND SubjectAccount AS ChangedBy | SelectÂ  TimeGenerated, Computer, TargetAccount, ChangedBy",
                    "Version": 1
                }
            },
            {
                "apiVersion": "2015-11-01-preview",
                "name": "AccountsCreated",
                "type": "savedSearches",
                "dependsOn": [
                    "[concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
                ],
                "properties": {
                    "Category": "ACS Report Queries",
                    "ETag": "*",
                    "DisplayName": "Account Management: User Accounts Created",
                    "Query": "Type=SecurityEvent (EventID=624 OR EventID=4720) | EXTEND SubjectAccount AS CreatedBy | Select TimeGenerated, TargetAccount, CreatedBy, Computer",
                    "Version": 1
                }
            },
            {
                "apiVersion": "2015-11-01-preview",
                "name": "AccountsDeleted",
                "type": "savedSearches",
                "dependsOn": [
                    "[concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
                ],
                "properties": {
                    "Category": "ACS Report Queries",
                    "ETag": "*",
                    "DisplayName": "Account Management: User Accounts Deleted",
                    "Query": "Type=SecurityEvent (EventID=630 OR EventID=4726) | EXTEND SubjectAccount AS DeletedBy | Select TimeGenerated, TargetAccount, DeletedBy, Computer",
                    "Version": 1
                }
            },
            {
                "apiVersion": "2015-11-01-preview",
                "name": "EventsComputer1",
                "type": "savedSearches",
                "dependsOn": [
                    "[concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
                ],
                "properties": {
                    "Category": "ACS Report Queries",
                    "ETag": "*",
                    "DisplayName": "Forensic: All Events For Specified Computer (Detail)",
                    "Query": "Type=SecurityEvent Computer=\"<<Computer Name>>\"",
                    "Version": 1
                }
            },
            {
                "apiVersion": "2015-11-01-preview",
                "name": "EventsComputer2",
                "type": "savedSearches",
                "dependsOn": [
                    "[concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
                ],
                "properties": {
                    "Category": "ACS Report Queries",
                    "ETag": "*",
                    "DisplayName": "Forensic: All Events For Specified Computer (Activity)",
                    "Query": "Type=SecurityEvent Computer=\"<<Computer Name>>\" | measure count() by Activity",
                    "Version": 1
                }
            },
            {
                "apiVersion": "2015-11-01-preview",
                "name": "EventsUser1",
                "type": "savedSearches",
                "dependsOn": [
                    "[concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
                ],
                "properties": {
                    "Category": "ACS Report Queries",
                    "ETag": "*",
                    "DisplayName": "Forensic: All Events For Specified User (Details)",
                    "Query": "Type=SecurityEvent Account=\"<<User Domain\\Account Name>>\"",
                    "Version": 1
                }
            },
            {
                "apiVersion": "2015-11-01-preview",
                "name": "EventsUser2",
                "type": "savedSearches",
                "dependsOn": [
                    "[concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
                ],
                "properties": {
                    "Category": "ACS Report Queries",
                    "ETag": "*",
                    "DisplayName": "Forensic: All Events For Specified User (Activity)",
                    "Query": "Type=SecurityEvent Account=\"<<User Domain\\Account Name>>\" | measure count() by Activity",
                    "Version": 1
                }
            },
            {
                "apiVersion": "2015-11-01-preview",
                "name": "EventsID1",
                "type": "savedSearches",
                "dependsOn": [
                    "[concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
                ],
                "properties": {
                    "Category": "ACS Report Queries",
                    "ETag": "*",
                    "DisplayName": "Forensic: All Events With Specified Event ID (Details)",
                    "Query": "Type=SecurityEvent EventID=\"<<Event Id>>\"",
                    "Version": 1
                }
            },
            {
                "apiVersion": "2015-11-01-preview",
                "name": "EventsID2",
                "type": "savedSearches",
                "dependsOn": [
                    "[concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
                ],
                "properties": {
                    "Category": "ACS Report Queries",
                    "ETag": "*",
                    "DisplayName": "Forensic: All Events With Specified Event ID (Computer)",
                    "Query": "Type=SecurityEvent EventID=\"<<Event Id>>\" | measure count() by Computer",
                    "Version": 1
                }
            },
            {
                "apiVersion": "2015-11-01-preview",
                "name": "EventsID3",
                "type": "savedSearches",
                "dependsOn": [
                    "[concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
                ],
                "properties": {
                    "Category": "ACS Report Queries",
                    "ETag": "*",
                    "DisplayName": "Forensic: All Events With Specified Event ID (Account)",
                    "Query": "Type=SecurityEvent EventID=\"<<Event Id>>\" | measure count() by Account",
                    "Version": 1
                }
            },
            {
                "apiVersion": "2015-11-01-preview",
                "name": "PlanningEvents1",
                "type": "savedSearches",
                "dependsOn": [
                    "[concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
                ],
                "properties": {
                    "Category": "ACS Report Queries",
                    "ETag": "*",
                    "DisplayName": "Planning: Event Counts",
                    "Query": "Type=SecurityEvent EventID!=0 | measure count() AS Count by Activity",
                    "Version": 1
                }
            },
            {
                "apiVersion": "2015-11-01-preview",
                "name": "PlanningEvents2",
                "type": "savedSearches",
                "dependsOn": [
                    "[concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
                ],
                "properties": {
                    "Category": "ACS Report Queries",
                    "ETag": "*",
                    "DisplayName": "Planning: Event Counts by Computer (Activity)",
                    "Query": "Type=SecurityEvent Computer=\"<<Computer Name>>\" | measure count() by Activity",
                    "Version": 1
                }
            },
            {
                "apiVersion": "2015-11-01-preview",
                "name": "PlanningEvents3",
                "type": "savedSearches",
                "dependsOn": [
                    "[concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
                ],
                "properties": {
                    "Category": "ACS Report Queries",
                    "ETag": "*",
                    "DisplayName": "Planning: Event Counts by Computer (Events)",
                    "Query": "Type=SecurityEvent Computer=\"<<Computer Name>>\" | measure count() by EventID",
                    "Version": 1
                }
            },
            {
                "apiVersion": "2015-11-01-preview",
                "name": "HourlyEvent1",
                "type": "savedSearches",
                "dependsOn": [
                    "[concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
                ],
                "properties": {
                    "Category": "ACS Report Queries",
                    "ETag": "*",
                    "DisplayName": "Planning: Hourly Event Distribution (Time)",
                    "Query": "Type=SecurityEvent EventID!=0 | measure count() AS Count by TimeGenerated Interval 1Hour",
                    "Version": 1
                }
            },
            {
                "apiVersion": "2015-11-01-preview",
                "name": "HourlyEvent2",
                "type": "savedSearches",
                "dependsOn": [
                    "[concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
                ],
                "properties": {
                    "Category": "ACS Report Queries",
                    "ETag": "*",
                    "DisplayName": "Planning: Hourly Event Distribution (Activity)",
                    "Query": "Type=SecurityEvent EventID!=0 AND EventID:[xx..yy] | measure count() AS Count by Activity Interval 1Hour",
                    "Version": 1
                }
            },
            {
                "apiVersion": "2015-11-01-preview",
                "name": "PrivilegedUsers1",
                "type": "savedSearches",
                "dependsOn": [
                    "[concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
                ],
                "properties": {
                    "Category": "ACS Report Queries",
                    "ETag": "*",
                    "DisplayName": "Planning: Logon Counts of Privileged Users",
                    "Query": "Type=SecurityEvent EventID=576 OR EventID=4672 AND SubjectDomainName!=\"NT AUTHORITY\" AND AccountType!=\"Machine\" | Select SubjectAccount, PrivilegeList",
                    "Version": 1
                }
            },
            {
                "apiVersion": "2015-11-01-preview",
                "name": "PrivilegedUsers2",
                "type": "savedSearches",
                "dependsOn": [
                    "[concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
                ],
                "properties": {
                    "Category": "ACS Report Queries",
                    "ETag": "*",
                    "DisplayName": "Planning: Logon Counts of Privileged Users",
                    "Query": "Type=SecurityEvent EventID=576 OR EventID=4672 AND SubjectDomainName!=\"NT AUTHORITY\" AND AccountType!=\"Machine\" | Measure Count() by SubjectAccount",
                    "Version": 1
                }
            },
            {
                "apiVersion": "2015-11-01-preview",
                "name": "AccountPolicy",
                "type": "savedSearches",
                "dependsOn": [
                    "[concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
                ],
                "properties": {
                    "Category": "ACS Report Queries",
                    "ETag": "*",
                    "DisplayName": "Policy: Account Policy Changed",
                    "Query": "Type=SecurityEvent EventID=643 OR EventID=4739 | Select Computer, Activity, TimeGenerated, EventData",
                    "Version": 1
                }
            },
            {
                "apiVersion": "2015-11-01-preview",
                "name": "AuditPolicy",
                "type": "savedSearches",
                "dependsOn": [
                    "[concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
                ],
                "properties": {
                    "Category": "ACS Report Queries",
                    "ETag": "*",
                    "DisplayName": "Policy: Audit Policy Changed",
                    "Query": "Type=SecurityEvent EventID=612 OR EventID=4719 | Select Computer, Activity, TimeGenerated, EventData",
                    "Version": 1
                }
            },
            {
                "apiVersion": "2015-11-01-preview",
                "name": "ObjectPermissions",
                "type": "savedSearches",
                "dependsOn": [
                    "[concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
                ],
                "properties": {
                    "Category": "ACS Report Queries",
                    "ETag": "*",
                    "DisplayName": "Policy: Object Permissions Changed",
                    "Query": "Type=SecurityEvent EventID=4670 | Select TimeGenerated, Activity, Computer, EventData",
                    "Version": 1
                }
            },
            {
                "apiVersion": "2015-11-01-preview",
                "name": "PrivilegeAddRemove",
                "type": "savedSearches",
                "dependsOn": [
                    "[concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
                ],
                "properties": {
                    "Category": "ACS Report Queries",
                    "ETag": "*",
                    "DisplayName": "Policy: Privilege Added Or Removed",
                    "Query": "Type=SecurityEvent EventID:[608..609] OR EventID:[621..622] OR EventID:[4704..4705] | Select TimeGenerated, Activity, Computer, EventData",
                    "Version": 1
                }
            },
            {
                "apiVersion": "2015-11-01-preview",
                "name": "SysIntAuditLogFail",
                "type": "savedSearches",
                "dependsOn": [
                    "[concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
                ],
                "properties": {
                    "Category": "ACS Report Queries",
                    "ETag": "*",
                    "DisplayName": "System Integrity: Audit Failure",
                    "Query": "Type=SecurityEvent EventID=516 OR EventID=4612 | Select TimeGenerated, Activity, Computer",
                    "Version": 1
                }
            },
            {
                "apiVersion": "2015-11-01-preview",
                "name": "SysIntAuditLogClear",
                "type": "savedSearches",
                "dependsOn": [
                    "[concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
                ],
                "properties": {
                    "Category": "ACS Report Queries",
                    "ETag": "*",
                    "DisplayName": "System Integrity: Audit Log Cleared",
                    "Query": "Type=SecurityEvent EventID=517 OR EventID=1102 | Select Activity, Computer, TimeGenerated, EventData",
                    "Version": 1
                }
            },
            {
                "apiVersion": "2015-11-01-preview",
                "name": "UsageObjAcc",
                "type": "savedSearches",
                "dependsOn": [
                    "[concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
                ],
                "properties": {
                    "Category": "ACS Report Queries",
                    "ETag": "*",
                    "DisplayName": "Usage: Object Access",
                    "Query": "Type=SecurityEvent EventID=560 OR EventID=567 OR EventID=4656 OR EventID=4663 | Select Computer, Activity, TimeGenerated, EventData",
                    "Version": 1
                }
            },
            {
                "apiVersion": "2015-11-01-preview",
                "name": "UsagePrivLog",
                "type": "savedSearches",
                "dependsOn": [
                    "[concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
                ],
                "properties": {
                    "Category": "ACS Report Queries",
                    "ETag": "*",
                    "DisplayName": "Usage: Privileged logon",
                    "Query": "Type=SecurityEvent EventID=576 OR EventID=4672 | Select TimeGenerated, Activity, Computer, SubjectAccount, PrivilegeList",
                    "Version": 1
                }
            },
            {
                "apiVersion": "2015-11-01-preview",
                "name": "UsageSecGrp",
                "type": "savedSearches",
                "dependsOn": [
                    "[concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
                ],
                "properties": {
                    "Category": "ACS Report Queries",
                    "ETag": "*",
                    "DisplayName": "Usage: Sensitive Security Groups Changes",
                    "Query": "Type=SecurityEvent EventID:[4727..4735] OR EventID=4737 OR EventID:[4754..4758] OR EventID:[631..639] OR EventID=641 OR EventID:[658..662] | EXTEND TargetUserName As GroupName | Select Activity, GroupName, SubjectAccount, MemberName, TimeGenerated",
                    "Version": 1
                }
            },
            {
                "apiVersion": "2015-11-01-preview",
                "name": "UsageUsrLog",
                "type": "savedSearches",
                "dependsOn": [
                    "[concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
                ],
                "properties": {
                    "Category": "ACS Report Queries",
                    "ETag": "*",
                    "DisplayName": "Usage: User Logon",
                    "Query": "Type=SecurityEvent EventID=528 OR EventID=540 OR EventID=4624 | Select TimeGenerated, Activity, Computer, IpAddress, AuthenticationPackageName, LogonProcessName, LogonTypeName, TargetAccount",
                    "Version": 1
                }
            },
            {
                "apiVersion": "2015-11-01-preview",
                "name": "FileResChg",
                "type": "savedSearches",
                "dependsOn": [
                    "[concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
                ],
                "properties": {
                    "Category": "ACS Report Queries",
                    "ETag": "*",
                    "DisplayName": "DAC: File Resource Property Changes",
                    "Query": "Type=SecurityEvent EventID=4911 | Select Computer, Activity, TimeGenerated, SubjectAccount, EventData",
                    "Version": 1
                }
            },
            {
                "apiVersion": "2015-11-01-preview",
                "name": "AccPolChg",
                "type": "savedSearches",
                "dependsOn": [
                    "[concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
                ],
                "properties": {
                    "Category": "ACS Report Queries",
                    "ETag": "*",
                    "DisplayName": "DAC: Central Access Policy For File Changes",
                    "Query": "Type=SecurityEvent EventID=4913 | Select Computer, Activity, TimeGenerated, SubjectAccount, EventData",
                    "Version": 1
                }
            },
            {
                "apiVersion": "2015-11-01-preview",
                "name": "ObjAttChg",
                "type": "savedSearches",
                "dependsOn": [
                    "[concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
                ],
                "properties": {
                    "Category": "ACS Report Queries",
                    "ETag": "*",
                    "DisplayName": "DAC: Object Attribute Changes",
                    "Query": "Type=SecurityEvent EventID=5136 OR EventID=5137 | Select Computer, Activity, TimeGenerated, SubjectAccount, EventData",
                    "Version": 1
                }
            }
        ]
        }
   ],
   "outputs": {

     }
}