# Using View Definition File to expose Custom Provider functions in a Managed App

The view definition file in the managed application package can be used to configure the managed application page to expose the various functionality of the custom provider in the UI. In the current sample we have exposed 2 functionalities using the custom provider, here we look at how these are exposed 

### Ping Action


```json
{
      "kind": "Overview",
      "properties": {
        "header": "Welcome to your DEMO Managed Application",
        "description": "This Managed application with Actions is for demo purposes only.",
        "commands": [
          {
            "displayName": "Ping Action",    // The display name for the button
            "path": "/customping",           // The call that will be made when the button is clicked.
            "icon": "LaunchCurrent"          // The type of the icon that will be used to display the button.
          }
        ]
      }
    }
```

In the above section we see the definition for the ping action. The path section with value of "/customping" defines the call made to the managed application that is forwarded to the custom resource provider. This call looks like follows :

```
POST  
https://management.azure.com/subscriptions/{subscriptionid}/resourceGroups/{resourcegroup}/providers/Microsoft.Solutions/applications/{applicationname}/customping?api-version=2018-09-01-preview
```

### Users Resource

This section defines the values to be added to the CustomResources section to create the users resource

```json
        {
      "kind": "CustomResources",
      "properties": {
        "displayName": "Users",                        // The display name of the custom resource used in the UI control
        "version": "1.0.0.0",
        "resourceType": "users",                       // The resource type that is to be created i.e the resource type name defined in the custom                                                       provider manifest
        "createUIDefinition": {                        // A createUIdefinition to be used to get inputs for the creation of the resource
            .
            .
            .
        },
        "columns": [                                   // This section defines how the resources will be displayed in the UI
          {
            "key": "properties.FullName",              // The user resource json property field used for this column
            "displayName": "Full Name"                 // The display name of the column
          },
          {
            "key": "properties.Location",
            "displayName": "Location"
          }
        ]
      }
    },
```


When the user is created the output from the createUIdefinition is used to populate the content part of the PUT call made on the resource. 

```JSON
        "createUIDefinition": {
          "parameters": {
            "steps": [
              {
                  .
                  .
                  .
              }
            ],
            "outputs": {
                "name": "[steps('add').name]",
                "properties" : {
                  "FullName": "[steps('add').name]",
                  "Location": "[steps('add').location]"
                }
            }
          }
        },
```

In the above example the output would look something like this : 

```JSON
            {
                "name": "johndoe",
                "properties" : {
                  "FullName": "johndoe",
                  "Location": "Unknown"
                }
            }
```

This value is used as the content field in the PUT call made to create the resource.

```
PUT
https://management.azure.com/subscriptions/{subscriptionid}/resourceGroups/{resourcegroup}/providers/Microsoft.Solutions/applications/{applicationname}/customusers/johndoe?api-version=2018-09-01-preview {output from createUidefinition}
```

Finally when we want to display the user the following command is run and parsed to display on screen :

```
GET  
https://management.azure.com/subscriptions/{subscriptionid}/resourceGroups/{resourcegroup}/providers/Microsoft.Solutions/applications/{applicationname}/customusers/johndoe?api-version=2018-09-01-preview
```

This returns : 

```
{
    "value": [
        {
            "properties": {
                "provisioningState": "Succeeded",
                "FullName": "johndoe",
                "Location": "Unknown"
            },
            "id": "/subscriptions/08ea5cea-9956-4928-beb5-4daff2ff9438/resourceGroups/AppWithProvider_managed/providers/Microsoft.CustomProviders/resourceProviders/public/users/johndoe",
            "name": "johndoe",
            "type": "Microsoft.CustomProviders/resourceProviders/users"
        }
    ]
}
```

Note that the values of the resource have an auto created values for id, name and type which is generated by the custom provider and just the values within the properties element are being populated with the exception of the provisioningState field which is generated based on the http status code of the return value. 
